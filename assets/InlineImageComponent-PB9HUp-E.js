import{a5 as e,r as t,l as a,u as n,s,m as i,d as l,a6 as r,y as o,b as c,a as d,q as u,C as m,o as h,w as g,I as p,t as f,e as x,j,P as C,R as v,Y as b,Z as w,a0 as E,a1 as N,a7 as y,a8 as k,a9 as S,B as I}from"./main-D8JS9Q0E.js";import{d as R}from"./LexicalNestedComposer-BTpcbf_x.js";const T=new Set;function _({altText:e,className:t,imageRef:a,src:n,width:s,height:i,position:l}){return function(e){if(!T.has(e))throw new Promise((t=>{const a=new Image;a.src=e,a.onload=()=>{T.add(e),t(null)}}))}(n),j.jsx("img",{className:t||void 0,src:n,alt:e,ref:a,"data-position":l,style:{display:"block",height:i,width:s},draggable:"false"})}function D({activeEditor:e,nodeKey:a,onClose:n}){const s=e.getEditorState().read((()=>l(a))),[i,r]=t.useState(s.getAltText()),[o,c]=t.useState(s.getShowCaption()),[d,u]=t.useState(s.getPosition());return j.jsxs(j.Fragment,{children:[j.jsx("div",{style:{marginBottom:"1em"},children:j.jsx(y,{label:"Alt Text",placeholder:"Descriptive alternative text",onChange:r,value:i,"data-test-id":"image-modal-alt-text-input"})}),j.jsxs(k,{style:{marginBottom:"1em",width:"208px"},value:d,label:"Position",name:"position",id:"position-select",onChange:e=>{u(e.target.value)},children:[j.jsx("option",{value:"left",children:"Left"}),j.jsx("option",{value:"right",children:"Right"}),j.jsx("option",{value:"full",children:"Full Width"})]}),j.jsxs("div",{className:"Input__wrapper",children:[j.jsx("input",{id:"caption",type:"checkbox",checked:o,onChange:e=>{c(e.target.checked)}}),j.jsx("label",{htmlFor:"caption",children:"Show Caption"})]}),j.jsx(S,{children:j.jsx(I,{"data-test-id":"image-modal-file-upload-btn",onClick:()=>(()=>{const t={altText:i,position:d,showCaption:o};s&&e.update((()=>{s.update(t)})),n()})(),children:"Confirm"})})]})}function B({src:y,altText:k,nodeKey:S,width:I,height:T,showCaption:B,caption:F,position:K}){const[P,L]=e(),A=t.useRef(null),U=t.useRef(null),[q,W,Y]=a(S),[Z]=n(),[z,G]=t.useState(null),H=t.useRef(null),J=t.useCallback((e=>{if(q&&s(i())){e.preventDefault();const t=l(S);if(r(t))return t.remove(),!0}return!1}),[q,S]),M=t.useCallback((e=>{const t=i(),a=U.current;if(q&&s(t)&&1===t.getNodes().length){if(B)return o(null),e.preventDefault(),F.focus(),!0;if(null!==a&&a!==document.activeElement)return e.preventDefault(),a.focus(),!0}return!1}),[F,q,B]),O=t.useCallback((e=>(H.current===F||U.current===e.target)&&(o(null),Z.update((()=>{W(!0);const e=Z.getRootElement();null!==e&&e.focus()})),!0)),[F,Z,W]);t.useEffect((()=>{let e=!0;const t=c(Z.registerUpdateListener((({editorState:t})=>{e&&G(t.read((()=>i())))})),Z.registerCommand(x,((e,t)=>(H.current=t,!1)),u),Z.registerCommand(f,(e=>{const t=e;return t.target===A.current&&(t.shiftKey?W(!q):(Y(),W(!0)),!0)}),u),Z.registerCommand(p,(e=>e.target===A.current&&(e.preventDefault(),!0)),u),Z.registerCommand(g,J,u),Z.registerCommand(h,J,u),Z.registerCommand(m,M,u),Z.registerCommand(d,O,u));return()=>{e=!1,t()}}),[Y,Z,q,S,J,M,O,W]);const Q=q&&s(z),V=q;return j.jsxs(t.Suspense,{fallback:null,children:[j.jsxs(j.Fragment,{children:[j.jsxs("span",{draggable:Q,children:[j.jsx("button",{className:"image-edit-button",ref:U,onClick:()=>{L("Update Inline Image",(e=>j.jsx(D,{activeEditor:Z,nodeKey:S,onClose:e})))},children:"Edit"}),j.jsx(_,{className:V?"focused "+(s(z)?"draggable":""):null,src:y,altText:k,imageRef:A,width:I,height:T,position:K})]}),B&&j.jsx("span",{className:"image-caption-container",children:j.jsxs(R,{initialEditor:F,children:[j.jsx(C,{}),j.jsx(v,{}),j.jsx(b,{contentEditable:j.jsx(w,{className:"InlineImageNode__contentEditable"}),placeholder:j.jsx(E,{className:"InlineImageNode__placeholder",children:"Enter a caption..."}),ErrorBoundary:N})]})})]}),P]})}export{D as UpdateInlineImageDialog,B as default};
