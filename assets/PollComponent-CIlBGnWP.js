import{u as e,r as o,l as t,s,m as n,d as l,aa as a,b as i,o as d,q as r,w as c,t as p,j as u,B as h,v as N,ab as _,ac as m}from"./main-D2o4Ey_l.js";function x({option:e,index:t,options:s,totalVotes:n,withPollNode:l}){const{clientID:a}=N(),i=o.useRef(null),d=e.votes,r=-1!==d.indexOf(a),c=d.length,p=e.text;return u.jsxs("div",{className:"PollNode__optionContainer",children:[u.jsx("div",{className:_("PollNode__optionCheckboxWrapper",r&&"PollNode__optionCheckboxChecked"),children:u.jsx("input",{ref:i,className:"PollNode__optionCheckbox",type:"checkbox",onChange:o=>{l((o=>{o.toggleVote(e,a)}))},checked:r})}),u.jsxs("div",{className:"PollNode__optionInputWrapper",children:[u.jsx("div",{className:"PollNode__optionInputVotes",style:{width:(0===c?0:c/n*100)+"%"}}),u.jsx("span",{className:"PollNode__optionInputVotesCount",children:c>0&&(1===c?"1 vote":`${c} votes`)}),u.jsx("input",{className:"PollNode__optionInput",type:"text",value:p,onChange:o=>{const t=o.target,s=t.value,n=t.selectionStart,a=t.selectionEnd;l((o=>{o.setOptionText(e,s)}),(()=>{t.selectionStart=n,t.selectionEnd=a}))},placeholder:`Option ${t+1}`})]}),u.jsx("button",{disabled:s.length<3,className:_("PollNode__optionDelete",s.length<3&&"PollNode__optionDeleteDisabled"),"aria-label":"Remove",onClick:()=>{l((o=>{o.deleteOption(e)}))}})]})}function f({question:N,options:_,nodeKey:f}){const[v]=e(),j=o.useMemo((()=>function(e){return e.reduce(((e,o)=>e+o.votes.length),0)}(_)),[_]),[P,g,C]=t(f),[b,k]=o.useState(null),O=o.useRef(null),y=o.useCallback((e=>{if(P&&s(n())){e.preventDefault();const o=l(f);if(a(o))return o.remove(),!0}return!1}),[P,f]);o.useEffect((()=>i(v.registerUpdateListener((({editorState:e})=>{k(e.read((()=>n())))})),v.registerCommand(p,(e=>{const o=e;return o.target===O.current&&(o.shiftKey||C(),g(!P),!0)}),r),v.registerCommand(c,y,r),v.registerCommand(d,y,r))),[C,v,P,f,y,g]);const D=(e,o)=>{v.update((()=>{const o=l(f);a(o)&&e(o)}),{onUpdate:o})},I=s(b)&&P;return u.jsx("div",{className:"PollNode__container "+(I?"focused":""),ref:O,children:u.jsxs("div",{className:"PollNode__inner",children:[u.jsx("h2",{className:"PollNode__heading",children:N}),_.map(((e,o)=>{const t=e.uid;return u.jsx(x,{withPollNode:D,option:e,index:o,options:_,totalVotes:j},t)})),u.jsx("div",{className:"PollNode__footer",children:u.jsx(h,{onClick:()=>{D((e=>{e.addOption(m())}))},small:!0,children:"Add Option"})})]})})}export{f as default};
