import{r as e,l as t,v as a,u as s,s as r,m as n,d as o,x as i,y as l,z as d,b as c,a as h,q as u,C as m,o as g,w as v,I as x,t as f,e as p,A as j,D as w,j as C,F as E,G as b,H as N,J as R,_ as S,L as y,N as V,O as z,P as H,Q as T,R as W,S as k,T as I,U as D,V as G,W as L,X as M,Y as _,Z as A,a0 as B,a1 as F,a2 as K,a3 as U}from"./main-xtp7KstN.js";import{d as P}from"./LexicalNestedComposer-CxYyG3So.js";import{I as q}from"./ImageResizer-D41Orhbo.js";const J="data:image/svg+xml,%3c?xml%20version='1.0'%20encoding='utf-8'?%3e%3c!--%20Uploaded%20to:%20SVG%20Repo,%20www.svgrepo.com,%20Generator:%20SVG%20Repo%20Mixer%20Tools%20--%3e%3csvg%20width='800px'%20height='800px'%20viewBox='0%200%2024%2024'%20fill='none'%20xmlns='http://www.w3.org/2000/svg'%3e%3cpath%20d='M22%203H2v18h20v-2h-2v-2h2v-2h-2v-2h2v-2h-2V9h2V7h-2V5h2V3zm-2%204v2h-2v2h2v2h-2v2h2v2h-2v2H4V5h14v2h2zm-6%202h-2v2h-2v2H8v2H6v2h2v-2h2v-2h2v-2h2v2h2v-2h-2V9zM6%207h2v2H6V7z'%20fill='%23000000'/%3e%3c/svg%3e",O=new Set,Q=U();function X({altText:e,className:t,imageRef:a,src:s,width:r,height:n,maxWidth:o,onError:i}){return function(e){if(!O.has(e))throw new Promise((t=>{const a=new Image;a.src=e,a.onload=()=>{O.add(e),t(null)},a.onerror=()=>{O.add(e)}}))}(s),C.jsx("img",{className:t||void 0,src:s,alt:e,ref:a,style:{height:n,maxWidth:o,width:r},onError:i,draggable:"false"})}function Y(){return C.jsx("img",{src:J,style:{height:200,opacity:.2,width:200},draggable:"false"})}function Z({src:U,altText:J,nodeKey:O,width:Z,height:$,maxWidth:ee,resizable:te,showCaption:ae,caption:se,captionsEnabled:re}){const ne=e.useRef(null),oe=e.useRef(null),[ie,le,de]=t(O),[ce,he]=e.useState(!1),{isCollabActive:ue}=a(),[me]=s(),[ge,ve]=e.useState(null),xe=e.useRef(null),[fe,pe]=e.useState(!1),je=e.useCallback((e=>{if(ie&&r(n())){e.preventDefault();const t=o(O);if(i(t))return t.remove(),!0}return!1}),[ie,O]),we=e.useCallback((e=>{const t=n(),a=oe.current;if(ie&&r(t)&&1===t.getNodes().length){if(ae)return l(null),e.preventDefault(),se.focus(),!0;if(null!==a&&a!==document.activeElement)return e.preventDefault(),a.focus(),!0}return!1}),[se,ie,ae]),Ce=e.useCallback((e=>(xe.current===se||oe.current===e.target)&&(l(null),me.update((()=>{le(!0);const e=me.getRootElement();null!==e&&e.focus()})),!0)),[se,me,le]),Ee=e.useCallback((e=>{const t=e;return!!ce||t.target===ne.current&&(t.shiftKey?le(!ie):(de(),le(!0)),!0)}),[ce,ie,le,de]),be=e.useCallback((e=>{me.getEditorState().read((()=>{const t=n();"IMG"===e.target.tagName&&d(t)&&1===t.getNodes().length&&me.dispatchCommand(Q,e)}))}),[me]);e.useEffect((()=>{let e=!0;const t=me.getRootElement(),a=c(me.registerUpdateListener((({editorState:t})=>{e&&ve(t.read((()=>n())))})),me.registerCommand(p,((e,t)=>(xe.current=t,!1)),u),me.registerCommand(f,Ee,u),me.registerCommand(Q,Ee,u),me.registerCommand(x,(e=>e.target===ne.current&&(e.preventDefault(),!0)),u),me.registerCommand(v,je,u),me.registerCommand(g,je,u),me.registerCommand(m,we,u),me.registerCommand(h,Ce,u));return null==t||t.addEventListener("contextmenu",be),()=>{e=!1,a(),null==t||t.removeEventListener("contextmenu",be)}}),[de,me,ce,ie,O,je,we,Ce,Ee,be,le]);const{historyState:Ne}=j(),{settings:{showNestedEditorTreeView:Re}}=w(),Se=ie&&r(ge)&&!ce,ye=ie||ce;return C.jsx(e.Suspense,{fallback:null,children:C.jsxs(C.Fragment,{children:[C.jsx("div",{draggable:Se,children:fe?C.jsx(Y,{}):C.jsx(X,{className:ye?"focused "+(r(ge)?"draggable":""):null,src:U,altText:J,imageRef:ne,width:Z,height:$,maxWidth:ee,onError:()=>pe(!0)})}),ae&&C.jsx("div",{className:"image-caption-container",children:C.jsxs(P,{initialEditor:se,initialNodes:[E,b,N,R,S,y,V,z],children:[C.jsx(H,{}),C.jsx(T,{}),C.jsx(W,{}),C.jsx(k,{}),C.jsx(I,{}),C.jsx(D,{}),ue?C.jsx(G,{id:se.getKey(),providerFactory:L,shouldBootstrap:!0}):C.jsx(M,{externalHistoryState:Ne}),C.jsx(_,{contentEditable:C.jsx(A,{className:"ImageNode__contentEditable"}),placeholder:C.jsx(B,{className:"ImageNode__placeholder",children:"Enter a caption..."}),ErrorBoundary:F}),!0===Re?C.jsx(K,{}):null]})}),te&&r(ge)&&ye&&C.jsx(q,{showCaption:ae,setShowCaption:()=>{me.update((()=>{const e=o(O);i(e)&&e.setShowCaption(!0)}))},editor:me,buttonRef:oe,imageRef:ne,maxWidth:ee,onResizeStart:()=>{he(!0)},onResizeEnd:(e,t)=>{setTimeout((()=>{he(!1)}),200),me.update((()=>{const a=o(O);i(a)&&a.setWidthAndHeight(e,t)}))},captionsEnabled:!fe&&re})]})})}export{Q as RIGHT_CLICK_IMAGE_COMMAND,Z as default};
