import{ad as e,u as t,r as n,v as o,ae as s,A as r,j as l,a4 as a,V as i,W as c,X as u,af as d,Z as g,a0 as f,a1 as p,d as m,ag as v}from"./main-DyeuHKo3.js";import{d as x}from"./LexicalNestedComposer-DoocXkYg.js";const y={...e,paragraph:"StickyEditorTheme__paragraph"};function E(e,t){const n=e.style,o=t.rootElementRect,s=null!==o?o.left:0,r=null!==o?o.top:0;n.top=r+t.y+"px",n.left=s+t.x+"px"}function h({x:e,y:h,nodeKey:j,color:R,caption:b}){const[C]=t(),k=n.useRef(null),L=n.useRef({isDragging:!1,offsetX:0,offsetY:0,rootElementRect:null,x:0,y:0}),{isCollabActive:N}=o();n.useEffect((()=>{const t=L.current;t.x=e,t.y=h;const n=k.current;null!==n&&E(n,t)}),[e,h]),s((()=>{const e=L.current,t=new ResizeObserver((t=>{for(let n=0;n<t.length;n++){const o=t[n],{target:s}=o;e.rootElementRect=s.getBoundingClientRect();const r=k.current;null!==r&&E(r,e)}})),n=C.registerRootListener(((e,n)=>{null!==n&&t.unobserve(n),null!==e&&t.observe(e)})),o=()=>{const t=C.getRootElement(),n=k.current;null!==t&&null!==n&&(e.rootElementRect=t.getBoundingClientRect(),E(n,e))};return window.addEventListener("resize",o),()=>{window.removeEventListener("resize",o),n()}}),[C]),n.useEffect((()=>{const e=k.current;null!==e&&setTimeout((()=>{e.style.setProperty("transition","top 0.3s ease 0s, left 0.3s ease 0s")}),500)}),[]);const D=e=>{const t=k.current,n=L.current,o=n.rootElementRect,s=a(t);null!==t&&n.isDragging&&null!==o&&(n.x=e.pageX/s-n.offsetX-o.left,n.y=e.pageY/s-n.offsetY-o.top,E(t,n))},X=e=>{const t=k.current,n=L.current;null!==t&&(n.isDragging=!1,t.classList.remove("dragging"),C.update((()=>{const e=m(j);v(e)&&e.setPosition(n.x,n.y)}))),document.removeEventListener("pointermove",D),document.removeEventListener("pointerup",X)},{historyState:w}=r();return l.jsx("div",{ref:k,className:"sticky-note-container",children:l.jsxs("div",{className:`sticky-note ${R}`,onPointerDown:e=>{const t=k.current;if(null==t||2===e.button||e.target!==t.firstChild)return;const n=t,o=L.current;if(null!==n){const{top:t,left:s}=n.getBoundingClientRect(),r=a(n);o.offsetX=e.clientX/r-s,o.offsetY=e.clientY/r-t,o.isDragging=!0,n.classList.add("dragging"),document.addEventListener("pointermove",D),document.addEventListener("pointerup",X),e.preventDefault()}},children:[l.jsx("button",{onClick:()=>{C.update((()=>{const e=m(j);v(e)&&e.remove()}))},className:"delete","aria-label":"Delete sticky note",title:"Delete",children:"X"}),l.jsx("button",{onClick:()=>{C.update((()=>{const e=m(j);v(e)&&e.toggleColor()}))},className:"color","aria-label":"Change sticky note color",title:"Color",children:l.jsx("i",{className:"bucket"})}),l.jsxs(x,{initialEditor:b,initialTheme:y,children:[N?l.jsx(i,{id:b.getKey(),providerFactory:c,shouldBootstrap:!0}):l.jsx(u,{externalHistoryState:w}),l.jsx(d,{contentEditable:l.jsx(g,{className:"StickyNode__contentEditable"}),placeholder:l.jsx(f,{className:"StickyNode__placeholder",children:"What's up?"}),ErrorBoundary:p})]})]})})}export{h as default};
