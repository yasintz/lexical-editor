import{r as e,j as n,u as t,d as a,$ as s,b as r,a as i,p as o,e as l,m as u,s as c,E as d,K as E}from"./main-DtWoDkrv.js";function m({equation:e,setEquation:t,inline:a},s){const r=e=>{t(e.target.value)};return a&&s instanceof HTMLInputElement?n.jsxs("span",{className:"EquationEditor_inputBackground",children:[n.jsx("span",{className:"EquationEditor_dollarSign",children:"$"}),n.jsx("input",{className:"EquationEditor_inlineEditor",value:e,onChange:r,autoFocus:!0,ref:s}),n.jsx("span",{className:"EquationEditor_dollarSign",children:"$"})]}):n.jsxs("div",{className:"EquationEditor_inputBackground",children:[n.jsx("span",{className:"EquationEditor_dollarSign",children:"$$\n"}),n.jsx("textarea",{className:"EquationEditor_blockEditor",value:e,onChange:r,ref:s}),n.jsx("span",{className:"EquationEditor_dollarSign",children:"\n$$"})]})}const f=e.forwardRef(m);function g({equation:m,inline:g,nodeKey:q}){const[x]=t(),[j,p]=e.useState(m),[h,N]=e.useState(!1),_=e.useRef(null),S=e.useCallback((e=>{N(!1),x.update((()=>{const n=a(q);s(n)&&(n.setEquation(j),e&&n.selectNext(0,0))}))}),[x,j,q]);return e.useEffect((()=>{h||j===m||p(m)}),[h,m,j]),e.useEffect((()=>h?r(x.registerCommand(l,(e=>{const n=document.activeElement;return _.current!==n&&S(),!1}),o),x.registerCommand(i,(e=>{const n=document.activeElement;return _.current===n&&(S(!0),!0)}),o)):x.registerUpdateListener((({editorState:e})=>{e.read((()=>{const e=u();return c(e)&&e.has(q)&&1===e.getNodes().length}))&&N(!0)}))),[x,q,S,h]),n.jsx(n.Fragment,{children:h?n.jsx(f,{equation:j,setEquation:p,inline:g,ref:_}):n.jsx(d,{onError:e=>x._onError(e),fallback:null,children:n.jsx(E,{equation:j,inline:g,onDoubleClick:()=>N(!0)})})})}export{g as default};
